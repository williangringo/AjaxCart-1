var Ikantam=window.Ikantam||{};Ikantam.AjaxCart={config:{},linkers:[],blocks:[],_session:0,addBlock:function(a){Ikantam.AjaxCart.blocks.push(a)},getBlock:function(c){var b=Ikantam.AjaxCart.blocks;for(var a=0;a<b.length;a++){if(b[a].id==c){return b[a]}}},query:function(b,a,c){if(this.getSession()!=b){return true}Ikantam.AjaxCart.showPreloader();jQuery.ajax({url:a,data:c,success:function(d){Ikantam.AjaxCart.renderResponse(d);Ikantam.AjaxCart.init()},complete:function(){Ikantam.AjaxCart.hidePreloader()}})},renderResponse:function(b){if(undefined===b.blocks){throw new Error("Blocks not found")}for(var a in b.blocks){var c=Ikantam.AjaxCart.getBlock(a);c.setContent(b.blocks[a])}},init:function(){var a=Ikantam.AjaxCart;a._session++;for(var b=0;b<a.linkers.length;b++){a.linkers[b].init()}},addLinker:function(a){Ikantam.AjaxCart.linkers.push(a)},registerEvent:function(a,c,b,e){var d=this.getSession();(function(f,h,g,j,i){h.on("click",function(k){f.controller.query(i,g,j);return false})})(a,c,b,e,d)},getSession:function(){return this._session},showPreloader:function(){jQuery("#iajaxcart-preloader").show()},hidePreloader:function(){jQuery("#iajaxcart-preloader").hide()}};Ikantam.AjaxCart.Block=function(b,a){this.id=b;this.selector=a};Ikantam.AjaxCart.Block.prototype={setContent:function(a){jQuery(this.selector).replaceWith(a)}};Ikantam.AjaxCart.CartLinker=function(a,b){this.controller=a;this.config=b};Ikantam.AjaxCart.CartLinker.prototype={init:function(){this.validator=new Ikantam.AjaxCart.LinkValidator(["checkout/cart/add","checkout/cart/delete"],{"checkout/cart":"iajaxcart/index"});this._unbindSetLocation();this._initSetLocation();this._initRemoveLink()},_unbindSetLocation:function(){var b=jQuery(this.config.selector.setLocation);for(var c=0;c<b.length;c++){var d=jQuery(b[c]);var a;if(a=d.attr("defaultOnclick")){d.attr("onclick",a);d.removeAttr("defaultOnclick")}}return this},_initSetLocation:function(){var b=jQuery(this.config.selector.setLocation);for(var c=0;c<b.length;c++){var e;if(e=this._isSetLocationValid(b[c])){var d=jQuery(b[c]);var a=d.attr("onclick");d.attr("defaultOnclick",a);d.removeAttr("onclick");this.controller.registerEvent(this,d,e,{})}}},_isSetLocationValid:function(c){c=jQuery(c);var b=c.attr("onclick");if(!b||b.indexOf("setLocation")===-1){return false}var e=/setLocation\('([\w'-:]*)'\)/;var d=b.match(e);if(d==null){return false}var a=d[1];if(this.validator.isValid(a)){return this.validator.prepareUrl(a)}return false},_initRemoveLink:function(){var a=jQuery(this.config.selector.removeLink);for(var b=0;b<a.length;b++){var c=jQuery(a[b]);var d;if(d=this._isRemoveLinkValid(c)){this.controller.registerEvent(this,c,d,{})}}},_isRemoveLinkValid:function(b){var a=b.attr("href");if(this.validator.isValid(a)){return this.validator.prepareUrl(a)}return false}};Ikantam.AjaxCart.AddToCartProductViewLinker=function(a,b){this.controller=a;this.config=b};Ikantam.AjaxCart.AddToCartProductViewLinker.prototype={init:function(){this.validator=new Ikantam.AjaxCart.LinkValidator(["checkout/cart/add","checkout/cart/updateItemOptions"],{"checkout/cart":"iajaxcart/index"});this._unbind();this._init()},_unbind:function(){var c=jQuery(this.config.selector.form);if(c){var b=c.find(this.config.selector.button);var a;if(b&&(a=b.attr("defaultOnclick"))){b.attr("onclick",a);b.removeAttr("defaultOnclick")}}},_init:function(){var d=jQuery(this.config.selector.form);var b=this._isValid(d);if(!b){return}var e=this.controller.getSession();(function(f,i,h,g){h.submit(function(){var j=h.serialize();f.controller.query(i,g,j);return false})})(this,e,d,b);var c=d.find(this.config.selector.button);var a=c.attr("onclick");c.attr("defaultOnclick",a);c.removeAttr("onclick");(function(f,i,h,g){c.click(function(){var j=h.serialize();f.controller.query(i,g,j);return false})})(this,e,d,b)},_isValid:function(a){if(!a){return false}var b=a.attr("action");if(this.validator.isValid(b)){return this.validator.prepareUrl(b)}return false}};Ikantam.AjaxCart.AddToCompareLinker=function(a,b){this.controller=a;this.config=b};Ikantam.AjaxCart.AddToCompareLinker.prototype={init:function(){this.validator=new Ikantam.AjaxCart.LinkValidator(["catalog/product_compare/add"],{"catalog/product_compare":"iajaxcart/compare"});this._unbind();this._init()},_unbind:function(){},_init:function(){var a=jQuery(this.config.selector.add);for(var c=0;c<a.length;c++){var d=jQuery(a[c]);var b=d.attr("href");if(this.validator.isValid(b)){b=this.validator.prepareUrl(b);this.controller.registerEvent(this,d,b,{})}}}};Ikantam.AjaxCart.RemoveFromCompareLinker=function(a,b){this.controller=a;this.config=b};Ikantam.AjaxCart.RemoveFromCompareLinker.prototype={init:function(){this.validator=new Ikantam.AjaxCart.LinkValidator(["catalog/product_compare/remove"],{"catalog/product_compare":"iajaxcart/compare"});this._unbind();this._init()},_unbind:function(){},_init:function(){var a=this._getLinks();for(var c=0;c<a.length;c++){var d=jQuery(a[c]);var b=d.attr("href");if(this.validator.isValid(b)){b=this.validator.prepareUrl(b);this.controller.registerEvent(this,d,b,{})}}},_getLinks:function(){return jQuery(this.config.selector.remove)}};Ikantam.AjaxCart.ClearAllCompareLinker=function(a,b){this.controller=a;this.config=b};Ikantam.AjaxCart.ClearAllCompareLinker.prototype={init:function(){this.validator=new Ikantam.AjaxCart.LinkValidator(["catalog/product_compare/clear"],{"catalog/product_compare":"iajaxcart/compare"});this._unbind();this._init()},_unbind:function(){},_init:function(){var a=this._getLinks();for(var c=0;c<a.length;c++){var d=jQuery(a[c]);var b=d.attr("href");if(this.validator.isValid(b)){b=this.validator.prepareUrl(b);this.controller.registerEvent(this,d,b,{})}}},_getLinks:function(){return jQuery(this.config.selector.link)}};Ikantam.AjaxCart.AddToWishlistLinker=function(a,b){this.controller=a;this.config=b};Ikantam.AjaxCart.AddToWishlistLinker.prototype={init:function(){this.validator=new Ikantam.AjaxCart.LinkValidator(["wishlist/index/add"],{"wishlist/index":"iajaxcart/wishlist"});this._unbind();this._init()},_unbind:function(){},_init:function(){var a=jQuery(this.config.selector.link);for(var c=0;c<a.length;c++){var d=jQuery(a[c]);var b=d.attr("href");if(this.validator.isValid(b)){b=this.validator.prepareUrl(b);this.controller.registerEvent(this,d,b,{})}}}};Ikantam.AjaxCart.RemoveFromWishlistLinker=function(a,b){this.controller=a;this.config=b};Ikantam.AjaxCart.RemoveFromWishlistLinker.prototype={init:function(){this.validator=new Ikantam.AjaxCart.LinkValidator(["wishlist/index/remove"],{"wishlist/index":"iajaxcart/wishlist"});this._unbind();this._init()},_unbind:function(){},_init:function(){var a=jQuery(this.config.selector.link);for(var c=0;c<a.length;c++){var d=jQuery(a[c]);var b=d.attr("href");if(this.validator.isValid(b)){b=this.validator.prepareUrl(b);this.controller.registerEvent(this,d,b,{})}}}};Ikantam.AjaxCart.LinkValidator=function(a,b){this.allowParts=a;this.replacement=b};Ikantam.AjaxCart.LinkValidator.prototype={isValid:function(a){if(!a){return false}for(var b in this.allowParts){if(a.indexOf(this.allowParts[b])>-1){return true}}return false},prepareUrl:function(a){for(var b in this.replacement){a=a.replace(b,this.replacement[b])}return a}};